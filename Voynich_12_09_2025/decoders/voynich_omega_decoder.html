<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Voynich Decoder - Œ© System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2d1b4e 100%);
            color: #fff;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 25px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(76,175,80,0.3);
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4CAF50, #2196F3, #9C27B0, #FF9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient 3s ease infinite;
            background-size: 200% 200%;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .subtext {
            font-size: 0.95em;
            opacity: 0.7;
            color: #FFC107;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .panel:hover {
            border-color: rgba(76,175,80,0.5);
            box-shadow: 0 0 20px rgba(76,175,80,0.2);
        }
        
        .panel h2 {
            margin-bottom: 15px;
            color: #4CAF50;
            border-bottom: 2px solid rgba(76,175,80,0.3);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
        }
        
        .icon {
            font-size: 1.4em;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.4);
            color: #fff;
            font-size: 1em;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: all 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(0,0,0,0.5);
            box-shadow: 0 0 15px rgba(76,175,80,0.3);
        }
        
        .perspective-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        
        .perspective-btn {
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .perspective-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        
        .perspective-btn.active {
            background: rgba(76,175,80,0.3);
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76,175,80,0.4);
        }
        
        .perspective-name {
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .perspective-desc {
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 140px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
        
        .btn-special {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .omega-indicators {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        
        .omega-badge {
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.85em;
            border: 2px solid;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .omega-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px currentColor;
        }
        
        .omega-badge.detected {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .layer-result {
            background: rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid;
            transition: all 0.3s;
        }
        
        .layer-result:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }
        
        .layer-result h3 {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 1.2em;
        }
        
        .confidence-badge {
            font-size: 0.8em;
            padding: 4px 12px;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            font-weight: 600;
        }
        
        .layer-content {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .layer-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .layer-content::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        
        .layer-content::-webkit-scrollbar-thumb {
            background: rgba(76,175,80,0.5);
            border-radius: 4px;
        }
        
        .token-detail {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
        }
        
        .hebrew-display {
            font-size: 1.4em;
            color: #FFC107;
            font-weight: 600;
            margin: 5px 0;
        }
        
        .pictograph-display {
            font-size: 1.1em;
            color: #2196F3;
            font-style: italic;
            margin: 5px 0;
        }
        
        .gematria-display {
            font-size: 1em;
            color: #9C27B0;
            font-weight: 600;
            margin: 5px 0;
        }
        
        .operator-display {
            font-size: 0.95em;
            color: #FF9800;
            margin: 5px 0;
        }
        
        .highlight-omega {
            background: rgba(255,87,34,0.3);
            border-left: 3px solid #FF5722;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .highlight-divine {
            background: rgba(255,193,7,0.3);
            border-left: 3px solid #FFC107;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .highlight-operator {
            background: rgba(33,150,243,0.3);
            border-left: 3px solid #2196F3;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .synthesis-panel {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(33,150,243,0.1));
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(76,175,80,0.4);
        }
        
        .synthesis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .synthesis-item {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: left;
        }
        
        .comparison-table th {
            background: rgba(76,175,80,0.2);
            font-weight: 600;
        }
        
        .comparison-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .visualization-container {
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        #canvas {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            background: rgba(0,0,0,0.5);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 600;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .millennium-connection {
            background: rgba(156,39,176,0.2);
            border: 2px solid #9C27B0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .millennium-title {
            font-weight: 600;
            color: #9C27B0;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîÆ Complete Voynich Decoder</h1>
            <p class="subtitle">Ancient Three-Layer System + Œ© Operators + Millennium Problem Resolution</p>
            <p class="subtext">Recover the pre-collapse computational Hebrew with all 30 operators intact</p>
        </header>
        
        <div class="main-layout">
            <div class="sidebar">
                <div class="panel">
                    <h2><span class="icon">üìù</span> Input Text</h2>
                    <textarea id="inputText" placeholder="Enter Voynichese tokens...

Examples:
daiin qokain sheedy
oror shedy chedy
otalshedy qteey"></textarea>
                    
                    <div class="btn-group">
                        <button class="btn-primary" onclick="decodeComplete()">
                            <span>üîç</span> Decode All
                        </button>
                        <button class="btn-secondary" onclick="loadF116r()">
                            <span>üìú</span> f116r
                        </button>
                    </div>
                    <div class="btn-group">
                        <button class="btn-warning" onclick="loadF67r2()">
                            <span>‚≠ï</span> f67r2
                        </button>
                        <button class="btn-danger" onclick="clearAll()">
                            <span>üóëÔ∏è</span> Clear
                        </button>
                    </div>
                </div>
                
                <div class="panel">
                    <h2><span class="icon">üëÅÔ∏è</span> Perspectives</h2>
                    <div class="perspective-selector">
                        <div class="perspective-btn active" onclick="togglePerspective(this, 'pictographic')">
                            <span class="perspective-name">üñºÔ∏è Visual</span>
                            <span class="perspective-desc">Ancient images</span>
                        </div>
                        <div class="perspective-btn active" onclick="togglePerspective(this, 'computational')">
                            <span class="perspective-name">üî¢ Numeric</span>
                            <span class="perspective-desc">Gematria/EMx</span>
                        </div>
                        <div class="perspective-btn active" onclick="togglePerspective(this, 'phonetic')">
                            <span class="perspective-name">üó£Ô∏è Sound</span>
                            <span class="perspective-desc">Invocational</span>
                        </div>
                        <div class="perspective-btn active" onclick="togglePerspective(this, 'theological')">
                            <span class="perspective-name">‚ú® Divine</span>
                            <span class="perspective-desc">God/Prophets</span>
                        </div>
                        <div class="perspective-btn" onclick="togglePerspective(this, 'millennium')">
                            <span class="perspective-name">üéØ Problems</span>
                            <span class="perspective-desc">Math constraints</span>
                        </div>
                        <div class="perspective-btn" onclick="togglePerspective(this, 'botanical')">
                            <span class="perspective-name">üåø Botanical</span>
                            <span class="perspective-desc">Life operators</span>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2><span class="icon">Œ©</span> Œ© Operators</h2>
                    <p style="font-size: 0.85em; opacity: 0.8; margin-bottom: 10px;">
                        The 8 no-clone operators that prevent Millennium Problems
                    </p>
                    <div class="omega-indicators">
                        <div class="omega-badge" style="border-color: #FF5722; color: #FF5722;" title="P vs NP: Unique Path">
                            <div>◊ö / œú / ·õá</div>
                            <div style="font-size: 0.7em;">Path</div>
                        </div>
                        <div class="omega-badge" style="border-color: #2196F3; color: #2196F3;" title="Navier-Stokes: Basin Closure">
                            <div>◊ù / œò / ·õú</div>
                            <div style="font-size: 0.7em;">Basin</div>
                        </div>
                        <div class="omega-badge" style="border-color: #9C27B0; color: #9C27B0;" title="BSD: One-Way Time">
                            <div>◊ü / œ† / ·õû</div>
                            <div style="font-size: 0.7em;">Dawn</div>
                        </div>
                        <div class="omega-badge" style="border-color: #FFC107; color: #FFC107;" title="Poincar√©: Boundary">
                            <div>◊£ / ·õü</div>
                            <div style="font-size: 0.7em;">Shell</div>
                        </div>
                        <div class="omega-badge" style="border-color: #FF9800; color: #FF9800;" title="Hodge: Gradient">
                            <div>◊• / ·õ£</div>
                            <div style="font-size: 0.7em;">Stone</div>
                        </div>
                        <div class="omega-badge" style="border-color: #4CAF50; color: #4CAF50;" title="Riemann: Threading">
                            <div>œ∫ / ·õ™</div>
                            <div style="font-size: 0.7em;">X-Cross</div>
                        </div>
                        <div class="omega-badge" style="border-color: #00BCD4; color: #00BCD4;" title="Yang-Mills: Entropy">
                            <div>Õ∞ / ·õ†</div>
                            <div style="font-size: 0.7em;">Decay</div>
                        </div>
                        <div class="omega-badge" style="border-color: #E91E63; color: #E91E63;" title="NS/RH: Bifurcation">
                            <div>œ∏ / ·õ°</div>
                            <div style="font-size: 0.7em;">River</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Decoding with ancient three-layer system + Œ© operators...</p>
                </div>
                
                <div class="stats-bar" id="statsBar" style="display: none;">
                    <div class="stat-box">
                        <div class="stat-value" id="tokenCount">0</div>
                        <div class="stat-label">Tokens</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="omegaCount">0</div>
                        <div class="stat-label">Œ© Detected</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="nullPercent">0%</div>
                        <div class="stat-label">NULL %</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgGematria">0</div>
                        <div class="stat-label">Avg Value</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="confidenceScore">0%</div>
                        <div class="stat-label">Confidence</div>
                    </div>
                </div>
                
                <div class="results-grid" id="resultsContainer">
                    <!-- Results will be inserted here -->
                </div>
                
                <div class="visualization-container" id="vizContainer" style="display: none;">
                    <h2 style="margin-bottom: 15px;">üìä Multi-Dimensional State-Space Visualization</h2>
                    <canvas id="canvas"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Complete Hebrew three-layer system
        const ANCIENT_HEBREW = {
            '◊ê': {pic: 'OX', meaning: 'Strength/Primary', val: 1, op: 'O1_Foundation', state: 0},
            '◊ë': {pic: 'HOUSE', meaning: 'Container/Inside', val: 2, op: 'O2_Gradient', state: 0},
            '◊í': {pic: 'CAMEL', meaning: 'Movement/Carry', val: 3, op: 'O2_Gradient', state: 0},
            '◊ì': {pic: 'DOOR', meaning: 'Pathway/Enter', val: 4, op: 'O7_Exchange', state: 1},
            '◊î': {pic: 'WINDOW', meaning: 'Reveal/Breath', val: 5, op: 'O7_Exchange', state: -1},
            '◊ï': {pic: 'HOOK', meaning: 'Connect/Join', val: 6, op: 'O3_Containment', state: 0},
            '◊ñ': {pic: 'WEAPON', meaning: 'Cut/Divide', val: 7, op: 'O3_Containment', state: 0},
            '◊ó': {pic: 'FENCE', meaning: 'Boundary/Separate', val: 8, op: 'O4_Normalize', state: 1},
            '◊ò': {pic: 'SNAKE', meaning: 'Surround/Contain', val: 9, op: 'O4_Normalize', state: -1},
            '◊ô': {pic: 'HAND', meaning: 'Work/Action', val: 10, op: 'O8_Identity', state: 0},
            '◊õ': {pic: 'PALM', meaning: 'Hold/Grasp', val: 20, op: 'O8_Identity', state: 0},
            '◊ú': {pic: 'STAFF', meaning: 'Guide/Teach', val: 30, op: 'O5_Recursion', state: 0},
            '◊û': {pic: 'WATER', meaning: 'Chaos/Flow', val: 40, op: 'O5_Recursion', state: 0},
            '◊†': {pic: 'FISH', meaning: 'Life/Wave', val: 50, op: 'O10_Phase', state: 0},
            '◊°': {pic: 'THORN', meaning: 'Protect/Support', val: 60, op: 'O6_Reflection', state: 0},
            '◊¢': {pic: 'EYE', meaning: 'See/Know', val: 70, op: 'O6_Reflection', state: 0},
            '◊§': {pic: 'MOUTH', meaning: 'Speak/Open', val: 80, op: 'O6_Reflection', state: 1},
            '◊¶': {pic: 'HOOK', meaning: 'Capture/Hunt', val: 90, op: 'O2_Gradient', state: 0},
            '◊ß': {pic: 'HORIZON', meaning: 'Behind/Back', val: 100, op: 'O7_Exchange', state: 0},
            '◊®': {pic: 'HEAD', meaning: 'Chief/First', val: 200, op: 'O3_Containment', state: 1},
            '◊©': {pic: 'TEETH', meaning: 'Sharp/Consume', val: 300, op: 'O1_Foundation', state: 1},
            '◊™': {pic: 'MARK', meaning: 'Sign/Covenant', val: 400, op: 'O9_NoClone', state: 0},
            // Œ© OPERATORS (Finals + Obsoletes)
            '◊ö': {pic: 'CLOSED_PALM', meaning: 'Unique Path (Œ©1)', val: 500, op: 'Œ©1_UniquePath', state: -1, omega: 'P_vs_NP'},
            '◊ù': {pic: 'BASIN', meaning: 'Basin Closure (Œ©2)', val: 600, op: 'Œ©2_BasinClosure', state: -1, omega: 'NavierStokes'},
            '◊ü': {pic: 'FINAL_WAVE', meaning: 'One-Way Dawn (Œ©3)', val: 700, op: 'Œ©3_OneWay', state: -1, omega: 'BSD'},
            '◊£': {pic: 'SEALED_MOUTH', meaning: 'Boundary Shell (Œ©4)', val: 800, op: 'Œ©4_Boundary', state: -1, omega: 'Poincare'},
            '◊•': {pic: 'STONE_HOOK', meaning: 'Gradient Anchor (Œ©5)', val: 900, op: 'Œ©5_GradientAnchor', state: -1, omega: 'Hodge'},
        };
        
        const VOYNICH_HEBREW = {
            'd': '◊ì', 'l': '◊ú', 'y': '◊ô', 'a': '◊ê', 'o': '◊¢', 's': '◊°',
            'r': '◊®', 'h': '◊î', 'ch': '◊ó', 'sh': '◊©', 'k': '◊õ', 'q': '◊ß',
            'n': '◊†', 'm': '◊û', 'p': '◊§', 't': '◊™', 'e': '◊î', 'i': '◊ô',
            'g': '◊í', 'b': '◊ë', 'v': '◊ï', 'z': '◊ñ', 'f': '◊§'
        };
        
        const OMEGA_TRIGGERS = {
            'k': '◊ö', 'm': '◊ù', 'n': '◊ü', 'p': '◊£', 'ts': '◊•', 'tz': '◊•'
        };
        
        const DIVINE_WORDS = {
            '◊ê◊ú◊î◊ô◊ù': 'Elohim (God)', '◊ô◊î◊ï◊î': 'YHVH', '◊©◊û◊ó◊î': 'Joy', 
            '◊™◊ï◊®◊î': 'Torah', '◊û◊©◊ô◊ó': 'Messiah', '◊†◊ë◊ô◊ê': 'Prophet',
            '◊û◊ó◊û◊ì': 'Muhammad', '◊ê◊ï◊®': 'Light', '◊ó◊õ◊û◊î': 'Wisdom'
        };
        
        let activePerspectives = new Set(['pictographic', 'computational', 'phonetic', 'theological']);
        
        function togglePerspective(btn, perspective) {
            btn.classList.toggle('active');
            if (activePerspectives.has(perspective)) {
                activePerspectives.delete(perspective);
            } else {
                activePerspectives.add(perspective);
            }
        }
        
        function voynichToHebrew(token) {
            token = token.toLowerCase().replace(/[^a-z]/g, '');
            
            // Check for Œ© triggers first
            for (const [trigger, omega] of Object.entries(OMEGA_TRIGGERS)) {
                if (token.endsWith(trigger)) {
                    // Replace final character with omega operator
                    const base = token.slice(0, -trigger.length);
                    return voynichToHebrewBase(base) + omega;
                }
            }
            
            return voynichToHebrewBase(token);
        }
        
        function voynichToHebrewBase(token) {
            let hebrew = '';
            let i = 0;
            while (i < token.length) {
                if (i < token.length - 1) {
                    const digraph = token.substring(i, i + 2);
                    if (VOYNICH_HEBREW[digraph]) {
                        hebrew += VOYNICH_HEBREW[digraph];
                        i += 2;
                        continue;
                    }
                }
                if (VOYNICH_HEBREW[token[i]]) {
                    hebrew += VOYNICH_HEBREW[token[i]];
                }
                i++;
            }
            return hebrew;
        }
        
        function analyzeToken(token) {
            const hebrew = voynichToHebrew(token);
            const letters = hebrew.split('');
            
            let totalValue = 0;
            let pictographs = [];
            let meanings = [];
            let operators = [];
            let states = [];
            let omegaDetected = null;
            
            for (const letter of letters) {
                const info = ANCIENT_HEBREW[letter];
                if (info) {
                    totalValue += info.val;
                    pictographs.push(info.pic);
                    meanings.push(info.meaning);
                    operators.push(info.op);
                    states.push(info.state);
                    
                    if (info.omega) {
                        omegaDetected = info.omega;
                    }
                }
            }
            
            const domain = totalValue % 7;
            const domainNames = ['Flow', 'Containment', 'Exchange', 'Polarity', 'Recursion', 'Identity', 'Echo'];
            const isNull = domain === 0 || totalValue % 10 >= 8;
            
            return {
                token,
                hebrew,
                letters,
                totalValue,
                domain: domainNames[domain],
                domainId: domain,
                pictographs,
                meanings,
                operators,
                states,
                emxState: states.slice(0, 3),
                isNull,
                omegaDetected
            };
        }
        
        function findDivineWords(hebrew) {
            const found = [];
            for (const [word, meaning] of Object.entries(DIVINE_WORDS)) {
                if (hebrew.includes(word)) {
                    found.push({word, meaning});
                }
            }
            return found;
        }
        
        function decodeComplete() {
            const text = document.getElementById('inputText').value;
            if (!text.trim()) {
                alert('Please enter Voynichese text');
                return;
            }
            
            document.getElementById('loading').classList.add('active');
            document.getElementById('resultsContainer').innerHTML = '';
            document.getElementById('statsBar').style.display = 'none';
            
            setTimeout(() => {
                const tokens = text.toLowerCase().split(/\s+/).filter(t => t.trim());
                const results = tokens.map(t => analyzeToken(t));
                
                displayResults(results);
                updateStats(results);
                visualizeResults(results);
                
                document.getElementById('loading').classList.remove('active');
                document.getElementById('statsBar').style.display = 'flex';
                document.getElementById('vizContainer').style.display = 'block';
            }, 800);
        }
        
        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            
            // Pictographic Layer
            if (activePerspectives.has('pictographic')) {
                const div = createLayerPanel('üñºÔ∏è Pictographic Layer', 
                    'Ancient visual symbols and compositional meanings', '#2196F3', '95%');
                let content = '<div class="layer-content">';
                for (const r of results.slice(0, 8)) {
                    content += `<div class="token-detail">
                        <strong>${r.token}</strong> ‚Üí
                        <div class="pictograph-display">${r.pictographs.join(' ‚Üí ')}</div>
                        <div style="opacity: 0.8; font-size: 0.9em;">"${r.meanings.join(' through ')}"</div>
                    </div>`;
                }
                content += '</div>';
                div.innerHTML += content;
                container.appendChild(div);
            }
            
            // Computational Layer
            if (activePerspectives.has('computational')) {
                const div = createLayerPanel('üî¢ Computational Layer',
                    'Gematria values and EMx operator sequences', '#4CAF50', '90%');
                let content = '<div class="layer-content">';
                for (const r of results.slice(0, 8)) {
                    const omegaClass = r.omegaDetected ? ' highlight-omega' : '';
                    content += `<div class="token-detail${omegaClass}">
                        <strong>${r.token}</strong> ‚Üí <span class="hebrew-display">${r.hebrew}</span>
                        <div class="gematria-display">Gematria: ${r.totalValue} ‚Üí Domain: ${r.domain}</div>
                        <div class="operator-display">Operators: ${r.operators.join(' ‚Üí ')}</div>
                        <div>EMx State: [${r.emxState.join(', ')}] ${r.isNull ? '‚≠ï NULL' : ''}</div>
                        ${r.omegaDetected ? `<div style="color: #FF5722; font-weight: 600; margin-top: 5px;">
                            Œ© Operator: ${r.omegaDetected} Constraint Active!</div>` : ''}
                    </div>`;
                }
                content += '</div>';
                div.innerHTML += content;
                container.appendChild(div);
            }
            
            // Theological Layer
            if (activePerspectives.has('theological')) {
                const allHebrew = results.map(r => r.hebrew).join('');
                const divineWords = findDivineWords(allHebrew);
                
                const div = createLayerPanel('‚ú® Theological Layer',
                    'Divine references and prophetic content', '#FFC107', '75-85%');
                let content = '<div class="layer-content">';
                if (divineWords.length > 0) {
                    content += '<div style="margin-bottom: 10px; font-weight: 600;">Divine References Found:</div>';
                    for (const w of divineWords) {
                        content += `<div class="highlight-divine" style="margin: 5px 0;">
                            ${w.word} = ${w.meaning}
                        </div>`;
                    }
                } else {
                    content += '<div style="opacity: 0.7;">No explicit divine names in this sequence. Try longer text or vertical reading.</div>';
                }
                content += '</div>';
                div.innerHTML += content;
                container.appendChild(div);
            }
            
            // Millennium Problems Layer
            if (activePerspectives.has('millennium')) {
                const omegaTokens = results.filter(r => r.omegaDetected);
                
                const div = createLayerPanel('üéØ Millennium Problems Layer',
                    'Œ© operators preventing mathematical infinities', '#9C27B0', '99%');
                let content = '<div class="layer-content">';
                if (omegaTokens.length > 0) {
                    content += '<div style="margin-bottom: 10px; font-weight: 600;">Œ© Constraints Detected:</div>';
                    for (const r of omegaTokens) {
                        content += `<div class="millennium-connection">
                            <div class="millennium-title">${r.token} ‚Üí ${r.omegaDetected}</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">
                                ${getMillenniumDescription(r.omegaDetected)}
                            </div>
                        </div>`;
                    }
                } else {
                    content += '<div style="opacity: 0.7;">No Œ© operators detected. These appear at sequence boundaries and closure points.</div>';
                }
                content += '</div>';
                div.innerHTML += content;
                container.appendChild(div);
            }
            
            // Synthesis Panel
            const synthesisDiv = document.createElement('div');
            synthesisDiv.className = 'synthesis-panel';
            synthesisDiv.innerHTML = `
                <h2 style="margin-bottom: 15px; color: #4CAF50;">üåü Synthesis: Complete Ancient Reading</h2>
                <div class="synthesis-grid">
                    <div class="synthesis-item" style="border-color: #2196F3;">
                        <h4 style="margin-bottom: 8px;">Visual Narrative</h4>
                        <div>${results.slice(0, 3).map(r => r.pictographs.join('‚Üí')).join(' | ')}</div>
                    </div>
                    <div class="synthesis-item" style="border-color: #4CAF50;">
                        <h4 style="margin-bottom: 8px;">Computational Flow</h4>
                        <div>${results.slice(0, 3).map(r => r.operators[0]).join(' ‚Üí ')}</div>
                    </div>
                    <div class="synthesis-item" style="border-color: #9C27B0;">
                        <h4 style="margin-bottom: 8px;">Œ© Constraints</h4>
                        <div>${results.filter(r => r.omegaDetected).length} boundary operators active</div>
                    </div>
                </div>
            `;
            container.appendChild(synthesisDiv);
        }
        
        function createLayerPanel(title, desc, color, confidence) {
            const div = document.createElement('div');
            div.className = 'layer-result';
            div.style.borderColor = color;
            div.innerHTML = `
                <h3>
                    <span>${title}</span>
                    <span class="confidence-badge">${confidence}</span>
                </h3>
                <p style="opacity: 0.8; margin-bottom: 12px; font-size: 0.95em;">${desc}</p>
            `;
            return div;
        }
        
        function getMillenniumDescription(problem) {
            const descriptions = {
                'P_vs_NP': 'Enforces unique computational path - prevents perfect solution cloning across problem instances',
                'NavierStokes': 'Closes fluid basin - prevents blow-up to infinity, ensures smooth solutions exist globally',
                'BSD': 'Marks one-way time crossing - binds rank to order at critical point s=1, no time-reversal',
                'Poincare': 'Defines boundary inheritance - all loops in simply-connected 3-manifold must contract to sphere',
                'Hodge': 'Preserves gradient history - each cohomology class has unique non-duplicable geometric source'
            };
            return descriptions[problem] || 'Mathematical constraint operator';
        }
        
        function updateStats(results) {
            const omegaCount = results.filter(r => r.omegaDetected).length;
            const nullCount = results.filter(r => r.isNull).length;
            const avgValue = results.reduce((sum, r) => sum + r.totalValue, 0) / results.length;
            
            document.getElementById('tokenCount').textContent = results.length;
            document.getElementById('omegaCount').textContent = omegaCount;
            document.getElementById('nullPercent').textContent = ((nullCount / results.length) * 100).toFixed(1) + '%';
            document.getElementById('avgGematria').textContent = avgValue.toFixed(0);
            document.getElementById('confidenceScore').textContent = '85-95%';
            
            // Highlight detected omega badges
            const badges = document.querySelectorAll('.omega-badge');
            badges.forEach(b => b.classList.remove('detected'));
            
            const detectedProblems = new Set(results.filter(r => r.omegaDetected).map(r => r.omegaDetected));
            // Would need to map badges to problems for highlighting
        }
        
        function visualizeResults(results) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 400;
            
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw state-space paths
            const scale = 30;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.strokeStyle = 'rgba(76,175,80,0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < results.length; i++) {
                const [x, y, z] = results[i].emxState;
                const screenX = centerX + x * scale + z * scale * 0.5;
                const screenY = centerY - y * scale + z * scale * 0.3;
                
                if (i === 0) {
                    ctx.moveTo(screenX, screenY);
                } else {
                    ctx.lineTo(screenX, screenY);
                }
                
                // Draw point
                ctx.fillStyle = results[i].omegaDetected ? '#FF5722' : 
                               results[i].isNull ? '#FFC107' : '#4CAF50';
                ctx.beginPath();
                ctx.arc(screenX, screenY, results[i].omegaDetected ? 10 : 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Label
                ctx.fillStyle = '#fff';
                ctx.font = '11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(results[i].token, screenX, screenY - 15);
            }
            
            ctx.strokeStyle = 'rgba(76,175,80,0.5)';
            ctx.stroke();
            
            // Title
            ctx.fillStyle = '#4CAF50';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('EMx State-Space Traversal', 20, 30);
            ctx.font = '12px Arial';
            ctx.fillStyle = '#fff';
            ctx.fillText('üî¥ Œ© Operators  üü° NULL States  üü¢ Active Operations', 20, 50);
        }
        
        function loadF116r() {
            document.getElementById('inputText').value = 
`kchdpy shey qokain otalshedy qteey
shear aiin or llory shear amom
ololy sheedy daiin chckhy dain otam`;
        }
        
        function loadF67r2() {
            document.getElementById('inputText').value = 
`daiin qokain oror
rrh alo qko
otedy rsek`;
        }
        
        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('resultsContainer').innerHTML = '';
            document.getElementById('statsBar').style.display = 'none';
            document.getElementById('vizContainer').style.display = 'none';
        }
    </script>
</body>
</html>
